<html>
<body>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
    const apiUrl = 'http://localhost:8080/login'; // Replace with the API endpoint URL

    function handleCredentialResponse(response) {
        console.log("Encoded JWT ID token: " + response.credential);
        const jwtToken = response.credential; // Replace with the actual JWT token you received

        // Decode the JWT token
        const base64Url = jwtToken.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const decodedPayload = JSON.parse(atob(base64));

        // Extract user data
        const userId = decodedPayload.sub;
        const userEmail = decodedPayload.email;
        const userName = decodedPayload.name;
        const userPicture = decodedPayload.picture;
        const userGivenName = decodedPayload.given_name;
        const userFamilyName = decodedPayload.family_name;

        // Use the extracted data as needed
        console.log('User ID:', userId);
        console.log('User Email:', userEmail);
        console.log('User Name:', userName);
        console.log('User Pict :', decodedPayload.picture);
        console.log('User Given Name :',decodedPayload.given_name);
        console.log('User Family Name :',decodedPayload.family_name);

        //fetch to API
        fetch(apiUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ idToken: jwtToken }),
        })
        .then(response => response.json())
        .then(data => {
            // Handle the API response
            console.log('API Response:', data);
        })
        .catch(error => {
            // Handle any errors during the request or response handling
            console.error('Error:', error);
        });
    }
    window.onload = function () {
    google.accounts.id.initialize({
        client_id: "573309958754-prkpslkji9sbhennbuoe7tq85tnvvjbp.apps.googleusercontent.com",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
    document.getElementById("buttonDiv"),
{ theme: "outline", size: "large" }  // customization attributes
    );
    google.accounts.id.prompt(); // also display the One Tap dialog
}

</script>
<div id="buttonDiv"></div>
</body>
</html>